<tal:edit_embedded define="plone_view context/@@plone;
                           foo plone_view/globalize;
                           form nocall: view/form;
                           field nocall: view/field;
                           fieldId view/fieldId;
                           portal_type field/portal_type;
                           errors nocall: view/errors;
                           atview field/@@at_base_edit_view;
                           allow_tabbing python: not atview.isMultiPageSchema();
                           schematas field/Schemata;
                           fieldsets python:[key for key in schematas.keys() if (schematas[key].editableFields(field, visible_only=True))];">

  <form name="edit_form"
        method="post"
        enctype="multipart/form-data"
        action=""
        id=""
        tal:attributes="action python:here.absolute_url()+'/'+template.id;
                        id string:fgfield-edit-form-${fieldId};
                        class python: allow_tabbing and 'fgfield-edit-form enableUnloadProtection enableAutoFocus enableFormTabbing atBaseEditForm' or 'fgfield-edit-form enableUnloadProtection enableAutoFocus atBaseEditForm';">
      <tal:tabbed tal:condition="allow_tabbing">
        <tal:fieldsets define="sole_fieldset python:len(fieldsets)==1"
          repeat="fieldset fieldsets">
          <fieldset tal:define="fieldsetid python:putils.normalizeString(fieldset)"
                  tal:attributes="id string:fieldset-${fieldId}-${fieldsetid}"
                  tal:omit-tag="sole_fieldset">
            <legend id=""
                    tal:content="python: atview.getTranslatedSchemaLabel(fieldset)"
                    tal:attributes="id string:fieldsetlegend-${fieldId}-${fieldsetid}"
                    tal:condition="not:sole_fieldset" />
            <tal:fields repeat="field python:schematas[fieldset].editableFields(field, visible_only=True)">
              <metal:fieldMacro use-macro="python:context.widget(field.getName(), mode='edit', field=field)" />
            </tal:fields>
          </fieldset>
        </tal:fieldsets>
      </tal:tabbed>
      <div class="formControls">
        <input type="button" value="Save" class="context fgfield-formbutton-save" 
               tal:attributes="id string:fgfield-${fieldId}-formbutton-save"/>
        <input type="button" value="Cancel" class="standalone fgfield-formbutton-cancel"
               tal:attributes="id string:fgfield-${fieldId}-formbutton-cancel"/>
      </div>
  </form>  
</tal:edit_embedded>
