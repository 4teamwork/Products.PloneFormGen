<tal:block metal:define-macro="master"
           define="errors nocall:view/errors | nothing;
                   request nocall: view/request;
                   schematas nothing;
                   allow_tabbing python:False;
                   fieldsets python:['default'];
                   default_fieldset string:default;
                   fieldset default_fieldset;
                   fgfields python:context.fgFields(request);
                   fields nocall: view/fgfields;
                   portal_type python:context.getPortalTypeName().lower().replace(' ', '_');
                   type_name context/getPortalTypeName|context/archetype_name;
                   base_macros context/fg_edit_macros_p3/macros;
                   edit_template python:'%s_edit' % portal_type;
                   edit_macros python:path('context/%s/macros | nothing' % edit_template);
                   header_macro edit_macros/header | header_macro | base_macros/header;
                   typedescription_macro edit_macros/typedescription | typedescription_macro | base_macros/typedescription;
                   body_macro edit_macros/body | body_macro | base_macros/body;
                   footer_macro edit_macros/footer | footer_macro | base_macros/footer;">

<html xmlns="http://www.w3.org/1999/xhtml"
      xml:lang="en"
      lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="plone">

  <metal:head fill-slot="top_slot">
    <tal:block define="macro edit_macros/topslot | nothing"
                    condition="macro">
      <metal:block use-macro="macro" />
    </tal:block>
  </metal:head>
  
  <metal:javascript_head fill-slot="javascript_head_slot">
    <tal:block define="macro context/archetypes_custom_js/macros/javascript_head | nothing"
               condition="macro">
      <metal:block use-macro="macro" />
    </tal:block>
    <script type="text/javascript" tal:attributes="src string:$portal_url/json2.js"></script>
    <script type="text/javascript" tal:attributes="src string:$portal_url/pfgFormBuild.js"></script>
    <script type="text/javascript" tal:attributes="src string:$portal_url/pfgFormBuild-utils.js"></script>
    <script type="text/javascript" tal:content="view/jsapp"></script>

    <tal:block define="macro edit_macros/javascript_head | nothing"
                    condition="macro">
      <metal:block use-macro="macro" />
    </tal:block>
  </metal:javascript_head>

  <metal:css fill-slot="css_slot">
    <style type="text/css"
           media="all"
           tal:content="structure string:<!-- @import url($portal_url/pfgFormBuild.css); -->">
    </style>
    <style type="text/css"
           media="all">
       #pfgActionEdit, #pfgThanksEdit, #pfg-qetable{clear:right;width:75%;}
       .editHook {text-align:center}
    </style>
    <tal:block define="macro edit_macros/css | nothing"
                    condition="macro">
      <metal:block use-macro="macro" />
    </tal:block>
  <tal:expr replace="structure context/getHeaderInjection | nothing" />
  </metal:css>
    
  <body>

    <metal:fill fill-slot="main">
      <metal:main define-macro="main"
                  tal:define="isLocked python:False;">

        <div tal:replace="structure provider:plone.abovecontenttitle" />
        
        <!-- switch buttons -->
        <div id="switch-fgform" class="fgswitchbutton" style="display:block"
            tal:content="structure context/maintenance_icon.gif" />
        <div id="switch-fgother" class="fgswitchbutton" style="display:none" 
            tal:content="structure context/form_icon.gif" />

        <h1 tal:content="context/Title" class="documentFirstHeading">
          Title or id
        </h1>
        
        <p class="documentDescription"
           tal:content="context/Description"
           tal:condition="context/Description">
            Description
        </p>

        <div tal:replace="structure provider:plone.abovecontentbody" />

        <div id="fgother" style="display:none" >
          <table id="pfgActionEdit"
                 class="listing"
                 summary="Field listing"
                 tal:define="liveAdapters context/getActionAdapter">
              <thead>
              <tr>
                  <th>Form Actions</th><th>Enabled</th><th>Delete</th><th>Edit</th>
              </tr>
              </thead>
              <tbody>
                  <tal:block tal:repeat="row python:context.actionAdaptersDL().items()">
                  <tr tal:attributes="class python:repeat['row'].index % 2 and 'even' or 'odd'">
                      <td tal:content="python:row[1]" />
                      <td class="editHook">
                        <form action="#">
                            <input type="checkbox" value="1"
                                tal:attributes="checked python:(row[0] in liveAdapters) and 'checked' or None;
                                id python:'cbaction-%s' % row[0];
                                name python:'cbaction-%s' % row[0]" />
                        </form>
                      </td>
                      <td class="editHook">
                          <a href="#" 
                             tal:attributes="href python:'%s/delete_confirmation' % row[0]"
                             title="Delete Action"
                             ><img src="delete_icon.gif" alt="Delete" /></a>
                      </td>
                      <td class="editHook">
                          <a href="#" 
                             tal:attributes="href python:'%s/edit' % row[0]"
                             title="Edit Field"
                             ><img src="edit.gif" alt="Edit" /></a>
                      </td>                    
                  </tr>
                  </tal:block>
              </tbody>
          </table>

          <table id="pfgThanksEdit"
                 class="listing"
                 summary="Field listing"
                 tal:define="liveThanks context/thanksPage">
              <thead>
                  <tr>
                      <th>Thanks Pages</th><th>Enabled</th><th>Delete</th><th>Edit</th>
                  </tr>
              </thead>
              <tbody>
                  <tal:block tal:repeat="row python:context.thanksPageVocabulary().items()">
                  <tr tal:attributes="class python:repeat['row'].index % 2 and 'even' or 'odd'">
                      <td tal:content="python:row[1]" />
                      <td class="editHook">
                        <form action="#">
                            <input type="radio" name="thanksRadio"
                                tal:attributes="value python:row[0];
                                  checked python:(row[0] == liveThanks) and 'checked' or None" />
                        </form>
                      </td>
                      <td class="editHook">
                          <a href="#" tal:condition="python:row[0]"
                             tal:attributes="href python:'%s/delete_confirmation' % row[0]"
                             title="Delete Page"
                             ><img src="delete_icon.gif" alt="Delete" /></a>
                          <tal:block tal:condition="python:not row[0]">&nbsp;</tal:block>
                      </td>
                      <td class="editHook">
                          <a href="#" tal:condition="python:row[0]"
                             tal:attributes="href python:'%s/edit' % row[0]"
                             title="Edit Page"
                             ><img src="edit.gif" alt="Edit" /></a>
                         <tal:block tal:condition="python:not row[0]">&nbsp;</tal:block>
                      </td>                    
                  </tr>
                  </tal:block>
              </tbody>
          </table>
        </div>

        <div id="fgform">
          <p tal:replace="structure context/getFormPrologue | nothing" />

          <div id="fgfields" class="fgfield-sortable">
            <tal:fieldrender repeat="field fields">
              <div class="fgfield-wrapper" 
                  tal:attributes="id string:fgfield-${field/getId}"
                  tal:content="structure field/fieldrenderer"/>
            </tal:fieldrender>
            <tal:comment replace="nothing">Blank space holder for add to the end</tal:comment>
            <div class="fgfield-blank"/>
          </div>

          <div class="fgfield-blank"> &nbsp; </div>

          <p tal:replace="structure context/getFormEpilogue | nothing" />

        </div>
      
        <div tal:replace="structure provider:plone.belowcontentbody"/>

      </metal:main>
    </metal:fill>

  </body>

</html>

</tal:block>
